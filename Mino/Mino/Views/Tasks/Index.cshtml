@model IEnumerable<Mino.Models.Tasks>
@{
    ViewBag.Title = "Index";
}
<ul class="tasks">
    @foreach (var task in Model)
    {
        <li>
            <div class="task-box js-task-box" data-task-id="@task.Id" data-project-id="@task.ProjectId" data-tag-id="@task.TagId"
                 @if (task.DateTime != null)
                 {
                     @:data-date = "@task.DateTime.Value.ToString("d MMM yyyy")"
                     @:data-time = "@task.DateTime.Value.ToString("HH:mm")"
                 }
            >
                <div class="task-tick">
                    <a href="#">
                        <i class="glyphicon glyphicon-unchecked"></i>
                    </a>
                </div>
                <div class="task-name">
                    @task.Name
                </div>
                <div class="task-attributes">
                    <div class="attr-section">
                        <span class="glyphicon glyphicon-record" style="color: #234;" aria-hidden="true"></span>
                        <span>
                            @if (task.ProjectId != null)
                            {
                                @task.Project.Name
                            }
                            else
                            {
                                @:Inbox
                            }
                        </span>
                    </div>
                    <div class="attr-section">
                        @if (task.TagId != null)
                        {
                            <span class="glyphicon glyphicon-flag"></span>
                            <span>@task.Tag.Name</span>
                        }
                    </div>
                </div>
            </div>
        </li>
    }
</ul>

@section scripts
{
    <script>
        $(document).ready(function () {
            var taskId = $('#Task_Id');
            $('.js-task-box').on('click',
                function () {
                    $('.js-sidebar-content').toggleClass('animated zoomOutLeft').toggleClass('animated zoomInLeft');
                    var editTaskContent = $('.js-edit-task-content');
                    if (editTaskContent.hasClass('hidden')) {
                        editTaskContent.toggleClass('animated zoomInLeft')
                            .toggleClass('animated zoomOutRight').toggleClass('hidden');

                        $('.js-edit-task-name').val($(this).find('.task-name').text().trim());
                        $('.js-edit-dropdown-projects').val($(this).attr('data-project-id'));
                        $('.js-edit-dropdown-tags').val($(this).attr('data-tag-id'));
                        $('.js-edit-date').val($(this).attr('data-date'));
                        $('.js-edit-time').val($(this).attr('data-time'));
                        taskId.val($(this).attr('data-task-id'));
                    } else {
                        editTaskContent.toggleClass('animated zoomInLeft')
                            .toggleClass('animated zoomOutRight');
                        setTimeout(function () {
                            editTaskContent.toggleClass('hidden');
                        }, 500);
                    }
                });

            $('.js-edit-task').on('click',
                function () {
                    $.post("/api/tasks/update",
                        {
                            name: $('.js-edit-task-name').val(),
                            taskId: taskId.val(),
                            projectId: $('.js-edit-dropdown-projects').val(),
                            tagId: $('.js-edit-dropdown-tags').val(),
                            date: $('.js-edit-date').val(),
                            time: $('.js-edit-time').val()
                        })
                        .done(function () {
                            location.reload();
                        })
                        .fail(function () {
                            alert('Something failed!');
                        });
                });
        });
    </script>
}

